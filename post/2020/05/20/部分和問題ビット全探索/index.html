<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>部分和問題（ビット全探索） | takayuki211.github.io</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">部分和問題（ビット全探索）</span></h1>

<h2 class="date">2020/05/20</h2>
</div>

<main>
<h2 id="課題意識">課題意識</h2>
<p>最近AtCoderを始めたが（正確に言うと、以前一度やり始めて、放置していた。今回こそは続ける。）、組み合わせについてfor文で計算するにあたってシフト演算を利用する方法があることを知ったのでメモしておく。</p>
<hr>
<h3 id="abc048-c---たくさんの数式">ABC048 C - たくさんの数式</h3>
<p><a href="https://atcoder.jp/contests/arc061/tasks/arc061_a">https://atcoder.jp/contests/arc061/tasks/arc061_a</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python3</span>

s <span style="color:#f92672">=</span> input()
n <span style="color:#f92672">=</span> len(s)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>

ss <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> s:
    ss<span style="color:#f92672">.</span>append(l)
    ss<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39;&#39;</span>)
s_list <span style="color:#f92672">=</span> ss[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
s_list_tmp <span style="color:#f92672">=</span> s_list<span style="color:#f92672">.</span>copy()

ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span>n): <span style="color:#75715e"># (1)組み合わせでループ</span>
    s_list_tmp <span style="color:#f92672">=</span> s_list<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(n): <span style="color:#75715e"># (2)桁でループ</span>
        <span style="color:#66d9ef">if</span> i<span style="color:#f92672">&gt;&gt;</span>k<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>: <span style="color:#75715e"># (3)k桁目が1のときの処理</span>
            s_list_tmp[<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;_&#39;</span>

    s_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(s_list_tmp)
    p_str <span style="color:#f92672">=</span> s_str<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;_&#39;</span>)
    p_list <span style="color:#f92672">=</span> list(map(int, p_str))
    ans <span style="color:#f92672">+=</span> sum(p_list)

<span style="color:#66d9ef">print</span>(ans)
</code></pre></div><p>入力されたテキストのどこに+(コードではアンダースコア)を挿入するべきか、という問題として捉えた。</p>
<p>(1)で<code>1&lt;&lt;n</code>としているが、これは1をn桁シフトしている。n=3のとき、1&laquo;3となり、これは2進数表記では1000となる（10進数の9として処理される）。forループはこの数未満の回数となるから、8回ループが回ることになる。</p>
<p>(2)において桁数でループする。例えばn=3では、000~111の場合を計算したい。この場合、3桁を調べれば良い。</p>
<p>(3)k桁目が1である場合に処理を行うこととしている。これによって、組み合わせをバイナリな表現によって処理している。</p>
<p><a href="https://qiita.com/drken/items/e77685614f3c6bf86f44#2-%E5%9F%BA%E7%A4%8E%E3%81%8B%E3%82%89%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88-----%E5%88%9D%E7%B4%9A%E7%B7%A8">こちら</a>のQiitaページを見るに、競プロ初心者向け問題では頻出の模様。ビット演算の他に、再帰関数でも解けるとのこと。（計算間に合うのかな？）</p>
<ul>
<li>ビット演算 <a href="https://qiita.com/drken/items/7c6ff2aa4d8fce1c9361">https://qiita.com/drken/items/7c6ff2aa4d8fce1c9361</a></li>
<li>再帰関数 <a href="https://qiita.com/drken/items/23a4f604fa3f505dd5ad">https://qiita.com/drken/items/23a4f604fa3f505dd5ad</a></li>
</ul>
<p>次回から上記Qiitaページの問題を順に解いていこう。
手始めに、いくつか関連問題も解いてみる。</p>
<hr>
<h3 id="abc079-c---train-ticket">ABC079 C - Train Ticket</h3>
<p><a href="https://atcoder.jp/contests/abc079/tasks/abc079_c">https://atcoder.jp/contests/abc079/tasks/abc079_c</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python3</span>

s <span style="color:#f92672">=</span> input()

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">3</span>):
    sum <span style="color:#f92672">=</span> int(s[<span style="color:#ae81ff">0</span>])
    ans <span style="color:#f92672">=</span> s[<span style="color:#ae81ff">0</span>]
    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>):
        <span style="color:#75715e"># print(k)</span>
        <span style="color:#66d9ef">if</span> i<span style="color:#f92672">&gt;&gt;</span>k<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>:
            sum <span style="color:#f92672">+=</span> int(s[k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>])
            ans <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;+&#39;</span> <span style="color:#f92672">+</span> s[k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
        <span style="color:#66d9ef">else</span>:
            sum <span style="color:#f92672">-=</span> int(s[k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>])
            ans <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> s[k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
    <span style="color:#66d9ef">if</span> sum <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>:
        <span style="color:#66d9ef">print</span>(ans <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;=7&#39;</span>)
        <span style="color:#66d9ef">break</span>
</code></pre></div><hr>
<h3 id="abc104-c---all-green">ABC104 C - All Green</h3>
<p><a href="https://atcoder.jp/contests/abc104/tasks/abc104_c">https://atcoder.jp/contests/abc104/tasks/abc104_c</a></p>
<p>・・・。これはもはやビット演算と関係ないのではないか？
タイトルにつけた「部分和問題」、恥ずかしながら知りませんでした。どうやら頻出問題で、DPで解くこともできるらしい。</p>
<p>→　Youtubeの解説を閲覧。
<a href="https://youtu.be/DEGyESFF8iE?t=1425">https://youtu.be/DEGyESFF8iE?t=1425</a></p>
<p>なるほど、問題ごとにボーナス点を取る・取らないの組み合わせが決まると、他に解くべき問題とその数は自動的に決まってくる。得点が高い問題から目標得点になるまで解いていけば良いから。したがって上の問題と同じようにバイナリで考えれば良い。やり方をカンニングした上でコードを書く。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python3</span>

<span style="color:#75715e"># データ読み込み</span>
d, g <span style="color:#f92672">=</span> map(int, input()<span style="color:#f92672">.</span>split())
p <span style="color:#f92672">=</span> []
c <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(d):
    pi, ci <span style="color:#f92672">=</span> map(int, input()<span style="color:#f92672">.</span>split())
    p<span style="color:#f92672">.</span>append(pi)
    c<span style="color:#f92672">.</span>append(ci)

ans <span style="color:#f92672">=</span> sum(p) <span style="color:#75715e"># 全部解いた場合を初期値にする</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span>d): <span style="color:#75715e"># 組み合わせループ（2^dパターン）</span>
    score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#75715e"># 完答問題の組み合わせから点数を計算する</span>
    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(d):
        <span style="color:#66d9ef">if</span> i<span style="color:#f92672">&gt;&gt;</span>k<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>: <span style="color:#75715e"># 1になっているビットに対応するボーナスポイントを獲得したとする</span>
            score <span style="color:#f92672">+=</span> (k<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>p[k] <span style="color:#75715e"># 通常得点を加算</span>
            score <span style="color:#f92672">+=</span> c[k] <span style="color:#75715e"># ボーナスポイントを加算</span>
            count <span style="color:#f92672">+=</span> p[k] <span style="color:#75715e"># 問題数を加算</span>

    <span style="color:#75715e"># 完答問題だけでスコアが目標を超えていなければ、残りの問題をスコアが目標に達するまで解く</span>
    <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&lt;</span> g:
        flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        add_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(d,<span style="color:#ae81ff">0</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>): <span style="color:#75715e"># k桁の上の桁からサーチ</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> i<span style="color:#f92672">&gt;&gt;</span>(k<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>: <span style="color:#75715e"># 完答していない問題(k桁目が0になっているビット)について</span>
                <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, p[k<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>): <span style="color:#75715e"># j問解いたとき</span>
                    score <span style="color:#f92672">+=</span> k<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span> <span style="color:#75715e"># 加算点</span>
                    add_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                    <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&gt;=</span> g:
                        flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
                        <span style="color:#66d9ef">break</span>
            <span style="color:#66d9ef">if</span> flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
                <span style="color:#66d9ef">break</span>
        count <span style="color:#f92672">+=</span> add_count

    <span style="color:#75715e"># スコアが目標を超えていれば回数を更新</span>
    <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&gt;=</span> g <span style="color:#f92672">and</span> ans <span style="color:#f92672">&gt;</span> count:
        ans <span style="color:#f92672">=</span> count

<span style="color:#66d9ef">print</span>(ans)
</code></pre></div><p>配列等のアライメントの難易度が高い。
どうにかコードを書いたものの、果たしてこれを制限時間内に解けるだろうか。</p>
<p>次回に続く。</p>

</main>

  <footer>
  <script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  
  <hr/>
  © <a href="https://takayuki211.github.io">Takayuki Yamamoto</a> 2020 | <a href="https://github.com/takayuki211">Github</a> | <a href="https://twitter.com/takayuki211">Twitter</a>
  
  </footer>
  </body>
</html>

